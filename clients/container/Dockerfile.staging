FROM node:18.10.0-alpine

ARG NODE_ENV
ARG PUBLIC_PATH
ARG USER_SERVICE
ARG BANK_SERVICE
ARG CACHE_SECRET_KEY
ARG CONTAINER_APP
ARG AUTH_APP
ARG BANK_APP

ENV NODE_ENV=${NODE_ENV}
ENV PUBLIC_PATH=${PUBLIC_PATH}
ENV USER_SERVICE: ${USER_SERVICE}
ENV BANK_SERVICE: ${BANK_SERVICE}
ENV CACHE_SECRET_KEY: ${CACHE_SECRET_KEY}
ENV CONTAINER_APP: ${CONTAINER_APP}
ENV AUTH_APP: ${AUTH_APP}
ENV BANK_APP: ${BANK_APP}

WORKDIR /usr/src/app

COPY package.json package.json
COPY package-lock.json package-lock.json

RUN npm install

COPY . .

RUN npm run webpack:build

EXPOSE 3004

CMD [ "npm", "run", "start:prod" ]